I"—<h1 id="dmkde-performance-on-pot_3"><code class="language-plaintext highlighter-rouge">DMKDE</code> performance on <code class="language-plaintext highlighter-rouge">pot_3</code></h1>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="n">cat</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">cpuinfo</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>processor	: 0
vendor_id	: GenuineIntel
cpu family	: 6
model		: 63
model name	: Intel(R) Xeon(R) CPU @ 2.30GHz
stepping	: 0
microcode	: 0x1
cpu MHz		: 2299.998
cache size	: 46080 KB
physical id	: 0
siblings	: 2
core id		: 0
cpu cores	: 1
apicid		: 0
initial apicid	: 0
fpu		: yes
fpu_exception	: yes
cpuid level	: 13
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl xtopology nonstop_tsc cpuid tsc_known_freq pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt aes xsave avx f16c rdrand hypervisor lahf_lm abm invpcid_single ssbd ibrs ibpb stibp fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt arat md_clear arch_capabilities
bugs		: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs
bogomips	: 4599.99
clflush size	: 64
cache_alignment	: 64
address sizes	: 46 bits physical, 48 bits virtual
power management:

processor	: 1
vendor_id	: GenuineIntel
cpu family	: 6
model		: 63
model name	: Intel(R) Xeon(R) CPU @ 2.30GHz
stepping	: 0
microcode	: 0x1
cpu MHz		: 2299.998
cache size	: 46080 KB
physical id	: 0
siblings	: 2
core id		: 0
cpu cores	: 1
apicid		: 1
initial apicid	: 1
fpu		: yes
fpu_exception	: yes
cpuid level	: 13
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl xtopology nonstop_tsc cpuid tsc_known_freq pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt aes xsave avx f16c rdrand hypervisor lahf_lm abm invpcid_single ssbd ibrs ibpb stibp fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt arat md_clear arch_capabilities
bugs		: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs
bogomips	: 4599.99
clflush size	: 64
cache_alignment	: 64
address sizes	: 46 bits physical, 48 bits virtual
power management:
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">display</span>
<span class="n">display</span><span class="p">.</span><span class="n">Image</span><span class="p">(</span><span class="s">"https://d3i71xaburhd42.cloudfront.net/0f899b92b7fb03b609fee887e4b6f3b633eaf30d/7-Figure3-1.png"</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span><span class="mi">666</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span><span class="mi">658</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_2_0.png" alt="png" /></p>

<h2 id="about-the-libraries-we-need">About the libraries we need</h2>

<p>Install <code class="language-plaintext highlighter-rouge">qmc</code></p>

<p>LetÂ´s install (git clone to the file system of the Colab VM) the module <code class="language-plaintext highlighter-rouge">qmc</code> which contains</p>
<blockquote>
  <p>Custom models inherited from the super class <code class="language-plaintext highlighter-rouge">tf.keras.Model</code>.</p>
</blockquote>

<blockquote>
  <p>Custom layers inherited from the super class <code class="language-plaintext highlighter-rouge">tf.keras.layers.Layer</code>.</p>
</blockquote>

<p>More information on customization when using <code class="language-plaintext highlighter-rouge">tf</code> this can be found at <a href="https://www.tensorflow.org/tutorials/customization/custom_layers#models_composing_layers">here</a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Install qmc if running in Google Colab
</span>
<span class="k">try</span><span class="p">:</span>
  <span class="kn">import</span> <span class="nn">google.colab</span>
  <span class="n">IN_COLAB</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">except</span><span class="p">:</span>
  <span class="n">IN_COLAB</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">if</span> <span class="n">IN_COLAB</span><span class="p">:</span>
    <span class="err">!</span><span class="n">rm</span> <span class="o">-</span><span class="n">R</span> <span class="n">qmc</span> <span class="n">qmc1</span>
    <span class="err">!</span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">fagonzalezo</span><span class="o">/</span><span class="n">qmc</span><span class="p">.</span><span class="n">git</span>
    <span class="err">!</span><span class="n">mv</span> <span class="n">qmc</span> <span class="n">qmc1</span>
    <span class="err">!</span><span class="n">mv</span> <span class="n">qmc1</span><span class="o">/</span><span class="n">qmc</span> <span class="p">.</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"../"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rm: cannot remove 'qmc': No such file or directory
rm: cannot remove 'qmc1': No such file or directory
Cloning into 'qmc'...
remote: Enumerating objects: 489, done.[K
remote: Counting objects: 100% (274/274), done.[K
remote: Compressing objects: 100% (194/194), done.[K
remote: Total 489 (delta 126), reused 205 (delta 77), pack-reused 215[K
Receiving objects: 100% (489/489), 37.03 MiB | 25.33 MiB/s, done.
Resolving deltas: 100% (217/217), done.
</code></pre></div></div>

<p>Install <code class="language-plaintext highlighter-rouge">KDEpy</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pip</span> <span class="n">install</span> <span class="n">KDEpy</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Collecting KDEpy
[?25l  Downloading https://files.pythonhosted.org/packages/55/2a/fef4546eabf1015bf70a977cb10ae0bf4c2a9c4b7317ffa0cf90fd4fd88b/KDEpy-1.1.0-cp37-cp37m-manylinux2010_x86_64.whl (387kB)
[K     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 389kB 4.9MB/s 
[?25hRequirement already satisfied: matplotlib&gt;=2.2.0 in /usr/local/lib/python3.7/dist-packages (from KDEpy) (3.2.2)
Requirement already satisfied: numpy&gt;=1.14.2 in /usr/local/lib/python3.7/dist-packages (from KDEpy) (1.19.5)
Requirement already satisfied: scipy&gt;=1.0.1 in /usr/local/lib/python3.7/dist-packages (from KDEpy) (1.4.1)
Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,&gt;=2.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib&gt;=2.2.0-&gt;KDEpy) (2.4.7)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib&gt;=2.2.0-&gt;KDEpy) (1.3.1)
Requirement already satisfied: cycler&gt;=0.10 in /usr/local/lib/python3.7/dist-packages (from matplotlib&gt;=2.2.0-&gt;KDEpy) (0.10.0)
Requirement already satisfied: python-dateutil&gt;=2.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib&gt;=2.2.0-&gt;KDEpy) (2.8.1)
Requirement already satisfied: six in /usr/local/lib/python3.7/dist-packages (from cycler&gt;=0.10-&gt;matplotlib&gt;=2.2.0-&gt;KDEpy) (1.15.0)
Installing collected packages: KDEpy
Successfully installed KDEpy-1.1.0
</code></pre></div></div>

<p>Install <code class="language-plaintext highlighter-rouge">fastKDE</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pip</span> <span class="n">install</span> <span class="n">fastkde</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Collecting fastkde
[?25l  Downloading https://files.pythonhosted.org/packages/31/47/5840d311fd69acd14d3285e91d71a177d5df13d614de77d9d967cf13f359/fastkde-1.0.19-cp37-cp37m-manylinux2010_x86_64.whl (952kB)
[K     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 962kB 6.7MB/s 
[?25hRequirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from fastkde) (1.19.5)
Requirement already satisfied: cython in /usr/local/lib/python3.7/dist-packages (from fastkde) (0.29.23)
Requirement already satisfied: scipy in /usr/local/lib/python3.7/dist-packages (from fastkde) (1.4.1)
Installing collected packages: fastkde
Successfully installed fastkde-1.0.19
</code></pre></div></div>

<p>General ones that include:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">pandas</code> : For managing dataframes that come from txt files.</li>
  <li><code class="language-plaintext highlighter-rouge">numpy</code> : For managing multidimensional arrays.</li>
  <li><code class="language-plaintext highlighter-rouge">pylab</code> : For plotting purposes.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="n">pl</span>
<span class="kn">from</span> <span class="nn">typeguard</span> <span class="kn">import</span> <span class="n">typechecked</span>
<span class="kn">import</span> <span class="nn">tensorflow_probability</span> <span class="k">as</span> <span class="n">tfp</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_blobs</span><span class="p">,</span> <span class="n">make_moons</span><span class="p">,</span> <span class="n">make_circles</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">euclidean_distances</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>
<span class="kn">import</span> <span class="nn">qmc.tf.layers</span> <span class="k">as</span> <span class="n">layers</span>
<span class="kn">import</span> <span class="nn">qmc.tf.models</span> <span class="k">as</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span><span class="p">,</span> <span class="n">bernoulli</span><span class="p">,</span> <span class="n">gaussian_kde</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">KDEpy</span> <span class="kn">import</span> <span class="n">NaiveKDE</span>
<span class="kn">from</span> <span class="nn">KDEpy</span> <span class="kn">import</span> <span class="n">TreeKDE</span>
<span class="kn">from</span> <span class="nn">KDEpy</span> <span class="kn">import</span> <span class="n">FFTKDE</span>
<span class="kn">from</span> <span class="nn">fastkde</span> <span class="kn">import</span> <span class="n">fastKDE</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KernelDensity</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">KFold</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
</code></pre></div></div>

<p>Clone repo for sampling made with Pytorch</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Install qmc if running in Google Colab
</span>
<span class="k">try</span><span class="p">:</span>
  <span class="kn">import</span> <span class="nn">google.colab</span>
  <span class="n">IN_COLAB</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">except</span><span class="p">:</span>
  <span class="n">IN_COLAB</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">if</span> <span class="n">IN_COLAB</span><span class="p">:</span>
    <span class="err">!</span><span class="n">rm</span> <span class="o">-</span><span class="n">R</span> <span class="n">nf</span>
    <span class="err">!</span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">VishakhG</span><span class="o">/</span><span class="n">normalizing</span><span class="o">-</span><span class="n">flows</span> <span class="n">nf</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"../"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rm: cannot remove 'nf': No such file or directory
Cloning into 'nf'...
remote: Enumerating objects: 49, done.[K
remote: Counting objects: 100% (49/49), done.[K
remote: Compressing objects: 100% (35/35), done.[K
remote: Total 49 (delta 12), reused 48 (delta 11), pack-reused 0[K
Unpacking objects: 100% (49/49), done.
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">nf.src.densities</span> <span class="k">as</span> <span class="n">densitiesnf</span>
<span class="kn">import</span> <span class="nn">nf.src.normalizing_flows</span> <span class="k">as</span> <span class="n">nfs</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.optim.lr_scheduler</span> <span class="kn">import</span> <span class="n">ReduceLROnPlateau</span>
<span class="kn">from</span> <span class="nn">torch.autograd</span> <span class="kn">import</span> <span class="n">Variable</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s">'axes.labelsize'</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
   <span class="s">'legend.fontsize'</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
   <span class="s">'xtick.labelsize'</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
   <span class="s">'ytick.labelsize'</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
   <span class="s">'text.usetex'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
   <span class="s">'figure.figsize'</span><span class="p">:</span> <span class="p">[</span><span class="mf">4.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">]</span>
   <span class="p">}</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="auxiliary-functions">Auxiliary functions</h2>

<p>Potential functions</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"""
Potential functions U(x) from Rezende et al. 2015
p(z) is then proportional to exp(-U(x)).
Since we log this value later in the optimized bound,
no need to actually exp().
"""</span>

<span class="k">def</span> <span class="nf">w_1</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tf</span><span class="p">.</span><span class="n">sin</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">w_2</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">tf</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">.</span><span class="mi">5</span> <span class="o">*</span> <span class="p">((</span><span class="n">z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">.</span><span class="mi">6</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">sigma</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">tf</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="n">x</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">w_3</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">((</span><span class="n">z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">.</span><span class="mi">3</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">pot_3</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="n">term_1</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">.</span><span class="mi">5</span> <span class="o">*</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">z</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">w_1</span><span class="p">(</span><span class="n">z</span><span class="p">))</span> <span class="o">/</span> <span class="p">.</span><span class="mi">35</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">term_2</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">.</span><span class="mi">5</span> <span class="o">*</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">z</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">w_1</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="n">w_2</span><span class="p">(</span><span class="n">z</span><span class="p">))</span> <span class="o">/</span> <span class="p">.</span><span class="mi">35</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="o">-</span> <span class="n">tf</span><span class="p">.</span><span class="n">math</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">term_1</span> <span class="o">+</span> <span class="n">term_2</span> <span class="o">+</span> <span class="mf">1e-7</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tf</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="n">u</span><span class="p">)</span><span class="o">/</span> <span class="mf">13.934</span>
</code></pre></div></div>

<p>Plot potential function</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plot_pot_func</span><span class="p">(</span><span class="n">pot_func</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e2</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e2</span><span class="p">))</span>
    <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">in_tens</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">xx</span><span class="p">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yy</span><span class="p">.</span><span class="n">ravel</span><span class="p">()]).</span><span class="n">T</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">pot_func</span><span class="p">(</span><span class="n">in_tens</span><span class="p">))).</span><span class="n">numpy</span><span class="p">().</span><span class="n">reshape</span><span class="p">(</span><span class="n">xx</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">'inferno'</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xx</span><span class="p">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
</code></pre></div></div>

<p>Constant for <code class="language-plaintext highlighter-rouge">DMKDE</code> and <code class="language-plaintext highlighter-rouge">EIG_DMKDE</code> predictions</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
  <span class="n">sigma</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">gamma</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">coefficient</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span>  <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">dimension</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">coefficient</span>
</code></pre></div></div>

<p>Define <code class="language-plaintext highlighter-rouge">raw_kde</code> method</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">raw_kde</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">x_train</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
  <span class="n">sigma</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">gamma</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">euclidean_distance</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(((</span><span class="n">x_test</span><span class="o">-</span><span class="n">x_train</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">exponential</span>  <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">euclidean_distance</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
  <span class="n">coefficient</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span>  <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">x_train</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> 
  <span class="n">constant_outside</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">x_train</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">coefficient</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">constant_outside</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">exponential</span><span class="p">)</span>  
  <span class="k">return</span> <span class="n">result</span>
</code></pre></div></div>

<h2 id="data">Data</h2>

<p>Energy functions from <code class="language-plaintext highlighter-rouge">Variational Inference with Normalizing Flows</code>
***</p>

<p>See the article <a href="http://proceedings.mlr.press/v37/rezende15.pdf">here</a> where the distribution of the data is given by the following equations:</p>

<p>1.
\(\frac{1}{2}\left(\frac{\|\mathbf{z}\|-2}{0.4}\right)^{2}-\ln \left(e^{-\frac{1}{2}\left[\frac{\mathbf{z}_{1}-2}{0.6}\right]^{2}}+e^{-\frac{1}{2}\left[\frac{\mathbf{z}_{1}+2}{0.6}\right]^{2}}\right)\)
2.
\(\frac{1}{2}\left[\frac{\mathbf{z}_{2}-w_{1}(\mathbf{z})}{0.4}\right]^{2}\)
3.
\(\boxed{
-\ln \left(e^{-\frac{1}{2}\left[\frac{\mathbf{z}_{2}-w_{1}(\mathbf{z})}{0.35}\right]^{2}}+e^{-\frac{1}{2}\left[\frac{\mathbf{z}_{2}-w_{1}(\mathbf{z})+w_{2}(\mathbf{z})}{0.35}\right]^{2}}\right)}\)
4.
\(-\ln \left(e^{-\frac{1}{2}\left[\frac{\mathbf{z}_{2}-w_{1}(\mathbf{z})}{0.4}\right]^{2}}+e^{-\frac{1}{2}\left[\frac{\mathbf{z}_{2}-w_{1}(\mathbf{z})+w_{3}(\mathbf{z})}{0.35}\right]^{2}}\right)\)</p>

<p>with $w_{1}(\mathbf{z})=\sin \left(\frac{2 \pi \mathbf{z}<em>{1}}{4}\right), w</em>{2}(\mathbf{z})=3 e^{-\frac{1}{2}\left[\frac{\left(\mathbf{z}<em>{1}-1\right)}{0.6}\right]^{2}}, w</em>{3}(\mathbf{z})=3 \sigma\left(\frac{\mathbf{z}_{1}-1}{0.3}\right) \text { and } \sigma(x)=\frac{1}{\left(1+e^{-x}\right)}$.</p>

<p>Sample size - Do not run</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sample_size</span> <span class="o">=</span> <span class="mi">1000000</span>
</code></pre></div></div>

<p>Generate the sample in an â€˜unboundedâ€™ setup - Do not run</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">tf</span><span class="p">.</span><span class="n">function</span>
<span class="k">def</span> <span class="nf">unnormalized_log_prob</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>  
  <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">res</span> <span class="o">=</span> <span class="n">pot_1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">res</span>

<span class="c1"># Initialize the HMC transition kernel.
</span><span class="n">num_results</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sample_size</span><span class="p">)</span>
<span class="n">num_burnin_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="n">adaptive_hmc</span> <span class="o">=</span> <span class="n">tfp</span><span class="p">.</span><span class="n">mcmc</span><span class="p">.</span><span class="n">SimpleStepSizeAdaptation</span><span class="p">(</span>
    <span class="n">tfp</span><span class="p">.</span><span class="n">mcmc</span><span class="p">.</span><span class="n">HamiltonianMonteCarlo</span><span class="p">(</span>
        <span class="n">target_log_prob_fn</span><span class="o">=</span><span class="n">unnormalized_log_prob</span><span class="p">,</span>
        <span class="n">num_leapfrog_steps</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="c1">#unrolled_leapfrog_steps=2,
</span>        <span class="n">state_gradients_are_stopped</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">step_size</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">])),</span>
    <span class="n">num_adaptation_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">num_burnin_steps</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">),</span>
      <span class="n">target_accept_prob</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">)</span>

<span class="c1"># Run the chain (with burn-in).
</span><span class="o">@</span><span class="n">tf</span><span class="p">.</span><span class="n">function</span>
<span class="k">def</span> <span class="nf">run_chain</span><span class="p">():</span>
  <span class="n">samples</span><span class="p">,</span> <span class="n">is_accepted</span> <span class="o">=</span> <span class="n">tfp</span><span class="p">.</span><span class="n">mcmc</span><span class="p">.</span><span class="n">sample_chain</span><span class="p">(</span>
      <span class="n">num_results</span><span class="o">=</span><span class="n">num_results</span><span class="p">,</span>
      <span class="n">num_burnin_steps</span><span class="o">=</span><span class="n">num_burnin_steps</span><span class="p">,</span>
      <span class="n">current_state</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">constant</span><span class="p">([[</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]]),</span>
      <span class="n">kernel</span><span class="o">=</span><span class="n">adaptive_hmc</span><span class="p">,</span>
      <span class="n">trace_fn</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_</span><span class="p">,</span> <span class="n">pkr</span><span class="p">:</span> <span class="p">[</span><span class="n">pkr</span><span class="p">.</span><span class="n">inner_results</span><span class="p">.</span><span class="n">is_accepted</span><span class="p">,</span> 
                               <span class="c1">#pkr.inner_results.accepted_results.step_size,
</span>                             <span class="n">pkr</span><span class="p">.</span><span class="n">inner_results</span><span class="p">.</span><span class="n">log_accept_ratio</span><span class="p">])</span>
  <span class="k">return</span> <span class="n">samples</span><span class="p">,</span> <span class="n">is_accepted</span>

<span class="n">samples</span><span class="p">,</span> <span class="n">is_accepted</span> <span class="o">=</span> <span class="n">run_chain</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span> <span class="o">=</span> <span class="n">samples</span><span class="p">.</span><span class="n">numpy</span><span class="p">().</span><span class="n">reshape</span><span class="p">(</span><span class="n">num_results</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<p>Save data</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="n">drive</span><span class="p">.</span><span class="n">mount</span><span class="p">(</span><span class="s">'/content/drive'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Mounted at /content/drive
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#np.savetxt(fname="/content/drive/MyDrive/UniversidadNacional/Thesis/Datasets/NF1/NF1_1M.csv", delimiter=" ", X = X)
</span></code></pre></div></div>

<p>Load data</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">"/content/drive/MyDrive/UniversidadNacional/Thesis/Datasets/NF3/nf3.npy"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(157367, 2)
</code></pre></div></div>

<p>Plot of Potential 1 vs. Samples</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="p">.</span><span class="n">flat</span>
<span class="n">plot_pot_func</span><span class="p">(</span><span class="n">pot_3</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Target density'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">sns</span><span class="p">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span> <span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Samples'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/local/lib/python3.7/dist-packages/seaborn/_decorators.py:43: FutureWarning: Pass the following variables as keyword args: x, y. From version 0.12, the only valid positional argument will be `data`, and passing other arguments without an explicit keyword will result in an error or misinterpretation.
  FutureWarning
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_43_1.png" alt="png" /></p>

<p>True densities</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_densities</span> <span class="o">=</span> <span class="n">pot_3</span><span class="p">(</span><span class="n">X</span><span class="p">).</span><span class="n">numpy</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(157367, 2)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_densities</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(157367,)
</code></pre></div></div>

<p>Scatter plot of the data</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="mf">0.25</span><span class="p">,</span><span class="mi">15</span><span class="o">*</span><span class="mf">0.25</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">X_densities</span> <span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Potential 3'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'alldensities_pot3.png'</span><span class="p">,</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_50_0.png" alt="png" /></p>

<p>Histogram of distances with 1000 samples - Do not run</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">distances_X</span> <span class="o">=</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="mi">1000</span><span class="p">],</span><span class="n">X</span><span class="p">[:</span><span class="mi">1000</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">distances_X</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="n">distances_X</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)].</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">density</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_52_0.png" alt="png" /></p>

<p>We suggest a <code class="language-plaintext highlighter-rouge">bw = 2.5</code>.</p>

<h2 id="experiment-1--10">Experiment 1 : 10</h2>

<p>Split data</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">X_train_densities</span><span class="p">,</span> <span class="n">X_test_densities</span>  <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X_densities</span><span class="p">,</span> <span class="n">train_size</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Train 2D data set shape is:</span><span class="si">{</span><span class="n">X_train</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s"> and their densities shape is </span><span class="si">{</span><span class="n">X_train_densities</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Train 2D data set shape is:</span><span class="si">{</span><span class="n">X_test</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s"> and their densities shape is </span><span class="si">{</span><span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Train 2D data set shape is:(10, 2) and their densities shape is (10,)
Train 2D data set shape is:(10000, 2) and their densities shape is (10000,)
</code></pre></div></div>

<p>Scatter plot of test data</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">X_test_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_59_0.png" alt="png" /></p>

<h3 id="fixing-bandwidth">Fixing bandwidth</h3>

<p>Cross Validation with 5 folds</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gammas</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">l1_error_means</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">gamma</span> <span class="ow">in</span> <span class="n">gammas</span><span class="p">:</span> 
  <span class="n">l1_error</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="c1">#print(gamma) 
</span>  <span class="c1"># Mean of accuracy on the 5 folds wrt rawkde
</span>  <span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">kf</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">X_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">X_train_new</span><span class="p">,</span> <span class="n">X_test_new</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">train_index</span><span class="p">,:],</span> <span class="n">X_train</span><span class="p">[</span><span class="n">test_index</span><span class="p">,:]</span>
    <span class="n">X_test_real_densities</span> <span class="o">=</span> <span class="n">pot_3</span><span class="p">(</span><span class="n">X_test_new</span><span class="p">).</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">raw_kde_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">raw_kde</span><span class="p">(</span><span class="n">xtest</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">X_train_new</span> <span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">)</span> <span class="k">for</span> <span class="n">xtest</span> <span class="ow">in</span> <span class="n">X_test_new</span><span class="p">])</span>    
    <span class="n">mae</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_real_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">raw_kde_densities</span> <span class="o">-</span> <span class="n">X_test_real_densities</span><span class="p">))</span>
    <span class="n">l1_error</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">mae</span><span class="p">)</span>    
    <span class="c1">#print(mae)
</span>  <span class="c1">#print('gamma:{} error:{}'.format(gamma,np.mean(l1_error)))
</span>  <span class="n">l1_error_means</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">l1_error</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Best gamma:{} with L1_error {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">gammas</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">l1_error_means</span><span class="p">)],</span><span class="n">np</span><span class="p">.</span><span class="nb">min</span><span class="p">(</span><span class="n">l1_error_means</span><span class="p">)))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Best gamma:2 with L1_error 0.05026825830060845
</code></pre></div></div>

<p>Fixed gamma</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span>
</code></pre></div></div>

<p>Fixed bandwidth</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bw</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">gamma</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bw</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.5
</code></pre></div></div>

<h3 id="methods">Methods</h3>

<h4 id="raw_kde"><code class="language-plaintext highlighter-rouge">raw_kde</code></h4>

<p>Train and evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span> 
  <span class="o">%</span><span class="n">time</span> <span class="n">raw_kde_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">raw_kde</span><span class="p">(</span><span class="n">xtest</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">X_train</span> <span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">)</span> <span class="k">for</span> <span class="n">xtest</span> <span class="ow">in</span> <span class="n">X_test</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 269 ms, sys: 0 ns, total: 269 ms
Wall time: 269 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">raw_kde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_73_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">raw_kde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.05034388550393431
</code></pre></div></div>

<h4 id="naivekde"><code class="language-plaintext highlighter-rouge">NaiveKDE</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">NaiveKDE_density</span> <span class="o">=</span> <span class="n">NaiveKDE</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bw</span> <span class="o">=</span> <span class="n">bw</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">NaiveKDE_densities</span> <span class="o">=</span> <span class="n">NaiveKDE_density</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 13.7 ms, sys: 0 ns, total: 13.7 ms
Wall time: 14.8 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">NaiveKDE_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_82_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">NaiveKDE_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.05034388558323307
</code></pre></div></div>

<h4 id="treekde"><code class="language-plaintext highlighter-rouge">TreeKDE</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">TreeKDE_density</span> <span class="o">=</span> <span class="n">TreeKDE</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bw</span> <span class="o">=</span> <span class="n">bw</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">TreeKDE_densities</span> <span class="o">=</span> <span class="n">TreeKDE_density</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 4.8 s, sys: 133 ms, total: 4.93 s
Wall time: 4.77 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">TreeKDE_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_91_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">TreeKDE_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.05035126389409076
</code></pre></div></div>

<h4 id="kerneldensityalgorithm--ball_tree"><code class="language-plaintext highlighter-rouge">KernelDensity(algorithm = 'ball_tree')</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">KernelDensitybt_density</span> <span class="o">=</span> <span class="n">KernelDensity</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">bw</span><span class="p">,</span> <span class="n">algorithm</span> <span class="o">=</span> <span class="s">'ball_tree'</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">KernelDensitybt_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">KernelDensitybt_density</span><span class="p">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 8.14 ms, sys: 2.95 ms, total: 11.1 ms
Wall time: 10.8 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">KernelDensitybt_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_100_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">KernelDensitybt_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.05034388558323315
</code></pre></div></div>

<h4 id="kerneldensityalgorithm--kd_tree"><code class="language-plaintext highlighter-rouge">KernelDensity(algorithm = 'kd_tree')</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">KernelDensitykdt_density</span> <span class="o">=</span> <span class="n">KernelDensity</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">bw</span><span class="p">,</span> <span class="n">algorithm</span> <span class="o">=</span> <span class="s">'kd_tree'</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">KernelDensitykdt_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">KernelDensitykdt_density</span><span class="p">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 13 ms, sys: 220 Âµs, total: 13.2 ms
Wall time: 15 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">KernelDensitykdt_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_109_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">KernelDensitykdt_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.05034388558323315
</code></pre></div></div>

<h4 id="fastkde"><code class="language-plaintext highlighter-rouge">fastKDE</code></h4>

<p>Train and evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">fastKDE_densities</span> <span class="o">=</span> <span class="n">fastKDE</span><span class="p">.</span><span class="n">pdf_at_points</span><span class="p">(</span><span class="n">X_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_train</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">list_of_points</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 7.43 s, sys: 3.36 ms, total: 7.44 s
Wall time: 7.43 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">fastKDE_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_116_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">fastKDE_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.05899017412015321
</code></pre></div></div>

<h4 id="dmkde"><code class="language-plaintext highlighter-rouge">DMKDE</code></h4>

<h5 id="dim--50">dim = 50</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_50</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_50</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_50</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1/1 [==============================] - 3s 3s/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f155fb36050&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_50</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 849 ms, sys: 96 ms, total: 945 ms
Wall time: 964 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_126_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.05958331909179688
</code></pre></div></div>

<h5 id="dim--100">dim = 100</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_100</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_100</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_100</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1/1 [==============================] - 0s 98ms/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f155cb9af90&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_100</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 2.01 s, sys: 146 ms, total: 2.16 s
Wall time: 1.65 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_135_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.064065673828125
</code></pre></div></div>

<h5 id="dim--500">dim = 500</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_500</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_500</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_500</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1/1 [==============================] - 0s 96ms/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f155bad29d0&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_500</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 1min 48s, sys: 2.14 s, total: 1min 50s
Wall time: 59.6 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_144_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.06446504516601563
</code></pre></div></div>

<h5 id="dim--1000">dim = 1000</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_1000</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_1000</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_1000</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1/1 [==============================] - 0s 99ms/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f155fba0b10&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_1000</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 12min 46s, sys: 8.77 s, total: 12min 55s
Wall time: 6min 43s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_153_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.06442227172851563
</code></pre></div></div>

<h4 id="eig-dmkde"><code class="language-plaintext highlighter-rouge">EIG-DMKDE</code></h4>

<h5 id="dim--50-1">dim = 50</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">sgd_model_50</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_50</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_50</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_160_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_50</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 711 ms, sys: 80.5 ms, total: 792 ms
Wall time: 650 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_164_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.0595833251953125
</code></pre></div></div>

<h5 id="dim--100-1">dim = 100</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">sgd_model_100</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_100</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_100</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_170_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_100</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 591 ms, sys: 65.7 ms, total: 656 ms
Wall time: 768 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_174_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.06406566162109376
</code></pre></div></div>

<h5 id="dim--500-1">dim = 500</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">sgd_model_500</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_500</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_500</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_180_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_500</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 651 ms, sys: 62.7 ms, total: 714 ms
Wall time: 771 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_184_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.06446622314453125
</code></pre></div></div>

<h5 id="dim--1000-1">dim = 1000</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">sgd_model_1000</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_1000</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_1000</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_190_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_1000</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 880 ms, sys: 79.1 ms, total: 959 ms
Wall time: 779 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_194_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.06443289184570312
</code></pre></div></div>

<h2 id="experiment-2--100">Experiment 2 : 100</h2>

<p>Split data</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">X_train_densities</span><span class="p">,</span> <span class="n">X_test_densities</span>  <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X_densities</span><span class="p">,</span> <span class="n">train_size</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Train 2D data set shape is:</span><span class="si">{</span><span class="n">X_train</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s"> and their densities shape is </span><span class="si">{</span><span class="n">X_train_densities</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Train 2D data set shape is:</span><span class="si">{</span><span class="n">X_test</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s"> and their densities shape is </span><span class="si">{</span><span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Train 2D data set shape is:(100, 2) and their densities shape is (100,)
Train 2D data set shape is:(10000, 2) and their densities shape is (10000,)
</code></pre></div></div>

<p>Scatter plot of test data</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">X_test_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_202_0.png" alt="png" /></p>

<h3 id="fixing-bandwidth-1">Fixing bandwidth</h3>

<p>Cross Validation with 5 folds</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gammas</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">l1_error_means</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">gamma</span> <span class="ow">in</span> <span class="n">gammas</span><span class="p">:</span> 
  <span class="n">l1_error</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="c1">#print(gamma) 
</span>  <span class="c1"># Mean of accuracy on the 5 folds wrt rawkde
</span>  <span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">kf</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">X_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">X_train_new</span><span class="p">,</span> <span class="n">X_test_new</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">train_index</span><span class="p">,:],</span> <span class="n">X_train</span><span class="p">[</span><span class="n">test_index</span><span class="p">,:]</span>
    <span class="n">X_test_real_densities</span> <span class="o">=</span> <span class="n">pot_3</span><span class="p">(</span><span class="n">X_test_new</span><span class="p">).</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">raw_kde_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">raw_kde</span><span class="p">(</span><span class="n">xtest</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">X_train_new</span> <span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">)</span> <span class="k">for</span> <span class="n">xtest</span> <span class="ow">in</span> <span class="n">X_test_new</span><span class="p">])</span>    
    <span class="n">mae</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_real_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">raw_kde_densities</span> <span class="o">-</span> <span class="n">X_test_real_densities</span><span class="p">))</span>
    <span class="n">l1_error</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">mae</span><span class="p">)</span>    
    <span class="c1">#print(mae)
</span>  <span class="c1">#print('gamma:{} error:{}'.format(gamma,np.mean(l1_error)))
</span>  <span class="n">l1_error_means</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">l1_error</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Best gamma:{} with L1_error {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">gammas</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">l1_error_means</span><span class="p">)],</span><span class="n">np</span><span class="p">.</span><span class="nb">min</span><span class="p">(</span><span class="n">l1_error_means</span><span class="p">)))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Best gamma:8 with L1_error 0.0314826476353402
</code></pre></div></div>

<p>Fixed gamma</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gamma</span> <span class="o">=</span> <span class="mi">8</span>
</code></pre></div></div>

<p>Fixed bandwidth</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bw</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">gamma</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bw</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.25
</code></pre></div></div>

<h3 id="methods-1">Methods</h3>

<h4 id="raw_kde-1"><code class="language-plaintext highlighter-rouge">raw_kde</code></h4>

<p>Train and evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span> 
  <span class="o">%</span><span class="n">time</span> <span class="n">raw_kde_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">raw_kde</span><span class="p">(</span><span class="n">xtest</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">X_train</span> <span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">)</span> <span class="k">for</span> <span class="n">xtest</span> <span class="ow">in</span> <span class="n">X_test</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 336 ms, sys: 4 ms, total: 340 ms
Wall time: 340 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">raw_kde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_216_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">raw_kde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.03327421690118173
</code></pre></div></div>

<h4 id="naivekde-1"><code class="language-plaintext highlighter-rouge">NaiveKDE</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">NaiveKDE_density</span> <span class="o">=</span> <span class="n">NaiveKDE</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bw</span> <span class="o">=</span> <span class="n">bw</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">NaiveKDE_densities</span> <span class="o">=</span> <span class="n">NaiveKDE_density</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 110 ms, sys: 3.89 ms, total: 113 ms
Wall time: 117 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">NaiveKDE_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_225_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">NaiveKDE_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.03327421701195262
</code></pre></div></div>

<h4 id="treekde-1"><code class="language-plaintext highlighter-rouge">TreeKDE</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">TreeKDE_density</span> <span class="o">=</span> <span class="n">TreeKDE</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bw</span> <span class="o">=</span> <span class="n">bw</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">TreeKDE_densities</span> <span class="o">=</span> <span class="n">TreeKDE_density</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 5 s, sys: 95.6 ms, total: 5.1 s
Wall time: 5.01 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">TreeKDE_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_234_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">TreeKDE_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.03327513041677673
</code></pre></div></div>

<h4 id="kerneldensityalgorithm--ball_tree-1"><code class="language-plaintext highlighter-rouge">KernelDensity(algorithm = 'ball_tree')</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">KernelDensitybt_density</span> <span class="o">=</span> <span class="n">KernelDensity</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">bw</span><span class="p">,</span> <span class="n">algorithm</span> <span class="o">=</span> <span class="s">'ball_tree'</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">KernelDensitybt_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">KernelDensitybt_density</span><span class="p">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 67.5 ms, sys: 2 ms, total: 69.5 ms
Wall time: 69.8 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">KernelDensitybt_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_243_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">KernelDensitybt_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.03327421701195266
</code></pre></div></div>

<h4 id="kerneldensityalgorithm--kd_tree-1"><code class="language-plaintext highlighter-rouge">KernelDensity(algorithm = 'kd_tree')</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">KernelDensitykdt_density</span> <span class="o">=</span> <span class="n">KernelDensity</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">bw</span><span class="p">,</span> <span class="n">algorithm</span> <span class="o">=</span> <span class="s">'kd_tree'</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">KernelDensitykdt_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">KernelDensitykdt_density</span><span class="p">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 68.4 ms, sys: 1 Âµs, total: 68.4 ms
Wall time: 68.2 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">KernelDensitykdt_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_252_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">KernelDensitykdt_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.03327421701195267
</code></pre></div></div>

<h4 id="fastkde-1"><code class="language-plaintext highlighter-rouge">fastKDE</code></h4>

<p>Train and evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">fastKDE_densities</span> <span class="o">=</span> <span class="n">fastKDE</span><span class="p">.</span><span class="n">pdf_at_points</span><span class="p">(</span><span class="n">X_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_train</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">list_of_points</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 15 s, sys: 34.9 ms, total: 15.1 s
Wall time: 15 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">fastKDE_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_259_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">fastKDE_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.04325479274329229
</code></pre></div></div>

<h4 id="dmkde-1"><code class="language-plaintext highlighter-rouge">DMKDE</code></h4>

<h5 id="dim--50-2">dim = 50</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_50</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_50</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_50</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WARNING:tensorflow:5 out of the last 5 calls to &lt;function Model.make_train_function.&lt;locals&gt;.train_function at 0x7f15576e1680&gt; triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has experimental_relax_shapes=True option that relaxes argument shapes that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.
4/4 [==============================] - 0s 3ms/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f15576e61d0&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_50</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 824 ms, sys: 566 ms, total: 1.39 s
Wall time: 1.34 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_269_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.078540234375
</code></pre></div></div>

<h5 id="dim--100-2">dim = 100</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_100</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_100</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_100</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WARNING:tensorflow:6 out of the last 9 calls to &lt;function Model.make_train_function.&lt;locals&gt;.train_function at 0x7f155765acb0&gt; triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has experimental_relax_shapes=True option that relaxes argument shapes that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.
4/4 [==============================] - 0s 3ms/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f1557665450&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_100</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 2.1 s, sys: 429 ms, total: 2.53 s
Wall time: 2 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_278_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.06161925659179688
</code></pre></div></div>

<h5 id="dim--500-2">dim = 500</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_500</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_500</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_500</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4/4 [==============================] - 0s 3ms/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f15576528d0&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_500</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 1min 50s, sys: 2.34 s, total: 1min 53s
Wall time: 1min 1s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_287_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.03902376708984375
</code></pre></div></div>

<h5 id="dim--1000-2">dim = 1000</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_1000</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_1000</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_1000</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4/4 [==============================] - 0s 4ms/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f1554c8a6d0&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_1000</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 12min 57s, sys: 4.89 s, total: 13min 1s
Wall time: 6min 44s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_296_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.03854382934570313
</code></pre></div></div>

<h4 id="eig-dmkde-1"><code class="language-plaintext highlighter-rouge">EIG-DMKDE</code></h4>

<h5 id="dim--50-3">dim = 50</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">sgd_model_50</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_50</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_50</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_303_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_50</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 600 ms, sys: 50.5 ms, total: 650 ms
Wall time: 776 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_307_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.078540234375
</code></pre></div></div>

<h5 id="dim--100-3">dim = 100</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">sgd_model_100</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_100</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_100</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_313_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_100</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 604 ms, sys: 67.6 ms, total: 672 ms
Wall time: 770 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_317_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.061619287109375004
</code></pre></div></div>

<h5 id="dim--500-3">dim = 500</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">sgd_model_500</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_500</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_500</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_323_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_500</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 892 ms, sys: 97.1 ms, total: 989 ms
Wall time: 715 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_327_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.039025000000000004
</code></pre></div></div>

<h5 id="dim--1000-3">dim = 1000</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">sgd_model_1000</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_1000</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_1000</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_333_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_1000</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 1.12 s, sys: 110 ms, total: 1.23 s
Wall time: 847 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_337_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.03855318603515625
</code></pre></div></div>

<h2 id="experiment-3--1000">Experiment 3 : 1000</h2>

<p>Split data</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">X_train_densities</span><span class="p">,</span> <span class="n">X_test_densities</span>  <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X_densities</span><span class="p">,</span> <span class="n">train_size</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Train 2D data set shape is:</span><span class="si">{</span><span class="n">X_train</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s"> and their densities shape is </span><span class="si">{</span><span class="n">X_train_densities</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Train 2D data set shape is:</span><span class="si">{</span><span class="n">X_test</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s"> and their densities shape is </span><span class="si">{</span><span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Train 2D data set shape is:(1000, 2) and their densities shape is (1000,)
Train 2D data set shape is:(10000, 2) and their densities shape is (10000,)
</code></pre></div></div>

<p>Scatter plot of test data</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">X_test_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_345_0.png" alt="png" /></p>

<h3 id="fixing-bandwidth-2">Fixing bandwidth</h3>

<p>Cross Validation with 5 folds</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gammas</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">l1_error_means</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">gamma</span> <span class="ow">in</span> <span class="n">gammas</span><span class="p">:</span> 
  <span class="n">l1_error</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="c1">#print(gamma) 
</span>  <span class="c1"># Mean of accuracy on the 5 folds wrt rawkde
</span>  <span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">kf</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">X_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">X_train_new</span><span class="p">,</span> <span class="n">X_test_new</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">train_index</span><span class="p">,:],</span> <span class="n">X_train</span><span class="p">[</span><span class="n">test_index</span><span class="p">,:]</span>
    <span class="n">X_test_real_densities</span> <span class="o">=</span> <span class="n">pot_3</span><span class="p">(</span><span class="n">X_test_new</span><span class="p">).</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">raw_kde_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">raw_kde</span><span class="p">(</span><span class="n">xtest</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">X_train_new</span> <span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">)</span> <span class="k">for</span> <span class="n">xtest</span> <span class="ow">in</span> <span class="n">X_test_new</span><span class="p">])</span>    
    <span class="n">mae</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_real_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">raw_kde_densities</span> <span class="o">-</span> <span class="n">X_test_real_densities</span><span class="p">))</span>
    <span class="n">l1_error</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">mae</span><span class="p">)</span>    
    <span class="c1">#print(mae)
</span>  <span class="c1">#print('gamma:{} error:{}'.format(gamma,np.mean(l1_error)))
</span>  <span class="n">l1_error_means</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">l1_error</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Best gamma:{} with L1_error {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">gammas</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">l1_error_means</span><span class="p">)],</span><span class="n">np</span><span class="p">.</span><span class="nb">min</span><span class="p">(</span><span class="n">l1_error_means</span><span class="p">)))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Best gamma:16 with L1_error 0.025187391689948373
</code></pre></div></div>

<p>Fixed gamma</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gamma</span> <span class="o">=</span> <span class="mi">16</span>
</code></pre></div></div>

<p>Fixed bandwidth</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bw</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">gamma</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bw</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.17677669529663687
</code></pre></div></div>

<h3 id="methods-2">Methods</h3>

<h4 id="raw_kde-2"><code class="language-plaintext highlighter-rouge">raw_kde</code></h4>

<p>Train and evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span> 
  <span class="o">%</span><span class="n">time</span> <span class="n">raw_kde_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">raw_kde</span><span class="p">(</span><span class="n">xtest</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">X_train</span> <span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">)</span> <span class="k">for</span> <span class="n">xtest</span> <span class="ow">in</span> <span class="n">X_test</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 598 ms, sys: 1.97 ms, total: 600 ms
Wall time: 601 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">raw_kde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_359_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">raw_kde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.025851071198926025
</code></pre></div></div>

<h4 id="naivekde-2"><code class="language-plaintext highlighter-rouge">NaiveKDE</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">NaiveKDE_density</span> <span class="o">=</span> <span class="n">NaiveKDE</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bw</span> <span class="o">=</span> <span class="n">bw</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">NaiveKDE_densities</span> <span class="o">=</span> <span class="n">NaiveKDE_density</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 981 ms, sys: 2.99 ms, total: 984 ms
Wall time: 992 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">NaiveKDE_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_368_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">NaiveKDE_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.025851071389962
</code></pre></div></div>

<h4 id="treekde-2"><code class="language-plaintext highlighter-rouge">TreeKDE</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">TreeKDE_density</span> <span class="o">=</span> <span class="n">TreeKDE</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bw</span> <span class="o">=</span> <span class="n">bw</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">TreeKDE_densities</span> <span class="o">=</span> <span class="n">TreeKDE_density</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 4.94 s, sys: 61.6 ms, total: 5 s
Wall time: 4.93 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">TreeKDE_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_377_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">TreeKDE_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.025847187098616123
</code></pre></div></div>

<h4 id="kerneldensityalgorithm--ball_tree-2"><code class="language-plaintext highlighter-rouge">KernelDensity(algorithm = 'ball_tree')</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">KernelDensitybt_density</span> <span class="o">=</span> <span class="n">KernelDensity</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">bw</span><span class="p">,</span> <span class="n">algorithm</span> <span class="o">=</span> <span class="s">'ball_tree'</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">KernelDensitybt_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">KernelDensitybt_density</span><span class="p">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 524 ms, sys: 1.81 ms, total: 526 ms
Wall time: 526 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">KernelDensitybt_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_386_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">KernelDensitybt_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.02585107138996177
</code></pre></div></div>

<h4 id="kerneldensityalgorithm--kd_tree-2"><code class="language-plaintext highlighter-rouge">KernelDensity(algorithm = 'kd_tree')</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">KernelDensitykdt_density</span> <span class="o">=</span> <span class="n">KernelDensity</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">bw</span><span class="p">,</span> <span class="n">algorithm</span> <span class="o">=</span> <span class="s">'kd_tree'</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">KernelDensitykdt_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">KernelDensitykdt_density</span><span class="p">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 550 ms, sys: 2.97 ms, total: 553 ms
Wall time: 554 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">KernelDensitykdt_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_395_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">KernelDensitykdt_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.025851071389961715
</code></pre></div></div>

<h4 id="fastkde-2"><code class="language-plaintext highlighter-rouge">fastKDE</code></h4>

<p>Train and evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">fastKDE_densities</span> <span class="o">=</span> <span class="n">fastKDE</span><span class="p">.</span><span class="n">pdf_at_points</span><span class="p">(</span><span class="n">X_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_train</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">list_of_points</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 14.3 s, sys: 24.3 ms, total: 14.4 s
Wall time: 14.3 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">fastKDE_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_402_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">fastKDE_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.026770251088810024
</code></pre></div></div>

<h4 id="dmkde-2"><code class="language-plaintext highlighter-rouge">DMKDE</code></h4>

<h5 id="dim--50-4">dim = 50</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_50</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_50</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_50</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>32/32 [==============================] - 0s 1ms/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f155baf8950&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_50</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 848 ms, sys: 65.5 ms, total: 914 ms
Wall time: 755 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_412_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.036019891357421875
</code></pre></div></div>

<h5 id="dim--100-4">dim = 100</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_100</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_100</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_100</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>32/32 [==============================] - 0s 1ms/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f1556e1d750&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_100</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 2.11 s, sys: 200 ms, total: 2.31 s
Wall time: 1.77 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_421_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.03572122192382813
</code></pre></div></div>

<h5 id="dim--500-4">dim = 500</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_500</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_500</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_500</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>32/32 [==============================] - 0s 2ms/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f1556e1dd90&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_500</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 1min 53s, sys: 3.15 s, total: 1min 56s
Wall time: 1min 3s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_430_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.025774255371093752
</code></pre></div></div>

<h5 id="dim--1000-4">dim = 1000</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_1000</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_1000</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_1000</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>32/32 [==============================] - 0s 4ms/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f155f211c90&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_1000</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 13min 6s, sys: 6.68 s, total: 13min 13s
Wall time: 6min 51s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_439_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.025683355712890626
</code></pre></div></div>

<h4 id="eig-dmkde-2"><code class="language-plaintext highlighter-rouge">EIG-DMKDE</code></h4>

<h5 id="dim--50-5">dim = 50</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">sgd_model_50</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_50</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_50</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_446_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_50</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 552 ms, sys: 66.5 ms, total: 619 ms
Wall time: 764 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_450_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.0360198974609375
</code></pre></div></div>

<h5 id="dim--100-5">dim = 100</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">sgd_model_100</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_100</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_100</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_456_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_100</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 601 ms, sys: 64.6 ms, total: 666 ms
Wall time: 770 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_460_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.03572123718261719
</code></pre></div></div>

<h5 id="dim--500-5">dim = 500</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">sgd_model_500</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_500</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_500</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_466_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_500</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 1.94 s, sys: 322 ms, total: 2.26 s
Wall time: 1.57 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_470_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.025774035644531252
</code></pre></div></div>

<h5 id="dim--1000-5">dim = 1000</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">sgd_model_1000</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_1000</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_1000</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_476_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_1000</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 3.05 s, sys: 200 ms, total: 3.25 s
Wall time: 2.02 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_480_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.025680862426757815
</code></pre></div></div>

<h2 id="experiment-4--10000">Experiment 4 : 10000</h2>

<p>Split data</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">X_train_densities</span><span class="p">,</span> <span class="n">X_test_densities</span>  <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X_densities</span><span class="p">,</span> <span class="n">train_size</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Train 2D data set shape is:</span><span class="si">{</span><span class="n">X_train</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s"> and their densities shape is </span><span class="si">{</span><span class="n">X_train_densities</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Train 2D data set shape is:</span><span class="si">{</span><span class="n">X_test</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s"> and their densities shape is </span><span class="si">{</span><span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Train 2D data set shape is:(10000, 2) and their densities shape is (10000,)
Train 2D data set shape is:(10000, 2) and their densities shape is (10000,)
</code></pre></div></div>

<p>Scatter plot of test data</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">X_test_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_488_0.png" alt="png" /></p>

<h3 id="fixing-bandwidth-3">Fixing bandwidth</h3>

<p>Cross Validation with 5 folds</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gammas</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">l1_error_means</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">gamma</span> <span class="ow">in</span> <span class="n">gammas</span><span class="p">:</span> 
  <span class="n">l1_error</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="c1">#print(gamma) 
</span>  <span class="c1"># Mean of accuracy on the 5 folds wrt rawkde
</span>  <span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">kf</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">X_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">X_train_new</span><span class="p">,</span> <span class="n">X_test_new</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">train_index</span><span class="p">,:],</span> <span class="n">X_train</span><span class="p">[</span><span class="n">test_index</span><span class="p">,:]</span>
    <span class="n">X_test_real_densities</span> <span class="o">=</span> <span class="n">pot_3</span><span class="p">(</span><span class="n">X_test_new</span><span class="p">).</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">raw_kde_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">raw_kde</span><span class="p">(</span><span class="n">xtest</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">X_train_new</span> <span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">)</span> <span class="k">for</span> <span class="n">xtest</span> <span class="ow">in</span> <span class="n">X_test_new</span><span class="p">])</span>    
    <span class="n">mae</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_real_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">raw_kde_densities</span> <span class="o">-</span> <span class="n">X_test_real_densities</span><span class="p">))</span>
    <span class="n">l1_error</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">mae</span><span class="p">)</span>    
    <span class="c1">#print(mae)
</span>  <span class="c1">#print('gamma:{} error:{}'.format(gamma,np.mean(l1_error)))
</span>  <span class="n">l1_error_means</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">l1_error</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Best gamma:{} with L1_error {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">gammas</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">l1_error_means</span><span class="p">)],</span><span class="n">np</span><span class="p">.</span><span class="nb">min</span><span class="p">(</span><span class="n">l1_error_means</span><span class="p">)))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Best gamma:32 with L1_error 0.019771328554758084
</code></pre></div></div>

<p>Fixed gamma</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gamma</span> <span class="o">=</span> <span class="mi">32</span>
</code></pre></div></div>

<p>Fixed bandwidth</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bw</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">gamma</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bw</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.125
</code></pre></div></div>

<h3 id="methods-3">Methods</h3>

<h4 id="raw_kde-3"><code class="language-plaintext highlighter-rouge">raw_kde</code></h4>

<p>Train and evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span> 
  <span class="o">%</span><span class="n">time</span> <span class="n">raw_kde_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">raw_kde</span><span class="p">(</span><span class="n">xtest</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">X_train</span> <span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">)</span> <span class="k">for</span> <span class="n">xtest</span> <span class="ow">in</span> <span class="n">X_test</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 3.1 s, sys: 3.65 ms, total: 3.1 s
Wall time: 3.11 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">raw_kde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_502_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">raw_kde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.019888643955384772
</code></pre></div></div>

<h4 id="naivekde-3"><code class="language-plaintext highlighter-rouge">NaiveKDE</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">NaiveKDE_density</span> <span class="o">=</span> <span class="n">NaiveKDE</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bw</span> <span class="o">=</span> <span class="n">bw</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">NaiveKDE_densities</span> <span class="o">=</span> <span class="n">NaiveKDE_density</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 7.49 s, sys: 16.9 ms, total: 7.51 s
Wall time: 7.51 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">NaiveKDE_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_511_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">NaiveKDE_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.019888644033525357
</code></pre></div></div>

<h4 id="treekde-3"><code class="language-plaintext highlighter-rouge">TreeKDE</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">TreeKDE_density</span> <span class="o">=</span> <span class="n">TreeKDE</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bw</span> <span class="o">=</span> <span class="n">bw</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">TreeKDE_densities</span> <span class="o">=</span> <span class="n">TreeKDE_density</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 5.06 s, sys: 36.1 ms, total: 5.1 s
Wall time: 5.08 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">TreeKDE_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_520_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">TreeKDE_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.019883829619887536
</code></pre></div></div>

<h4 id="kerneldensityalgorithm--ball_tree-3"><code class="language-plaintext highlighter-rouge">KernelDensity(algorithm = 'ball_tree')</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">KernelDensitybt_density</span> <span class="o">=</span> <span class="n">KernelDensity</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">bw</span><span class="p">,</span> <span class="n">algorithm</span> <span class="o">=</span> <span class="s">'ball_tree'</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">KernelDensitybt_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">KernelDensitybt_density</span><span class="p">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 2.85 s, sys: 4.43 ms, total: 2.86 s
Wall time: 2.85 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">KernelDensitybt_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_529_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">KernelDensitybt_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.019888644033523837
</code></pre></div></div>

<h4 id="kerneldensityalgorithm--kd_tree-3"><code class="language-plaintext highlighter-rouge">KernelDensity(algorithm = 'kd_tree')</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">KernelDensitykdt_density</span> <span class="o">=</span> <span class="n">KernelDensity</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">bw</span><span class="p">,</span> <span class="n">algorithm</span> <span class="o">=</span> <span class="s">'kd_tree'</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">KernelDensitykdt_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">KernelDensitykdt_density</span><span class="p">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 3.88 s, sys: 9.17 ms, total: 3.89 s
Wall time: 3.89 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">KernelDensitykdt_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_538_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">KernelDensitykdt_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.019888644033522737
</code></pre></div></div>

<h4 id="fastkde-3"><code class="language-plaintext highlighter-rouge">fastKDE</code></h4>

<p>Train and evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">fastKDE_densities</span> <span class="o">=</span> <span class="n">fastKDE</span><span class="p">.</span><span class="n">pdf_at_points</span><span class="p">(</span><span class="n">X_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_train</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">list_of_points</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 14.7 s, sys: 13.1 ms, total: 14.7 s
Wall time: 14.7 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">fastKDE_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_545_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">fastKDE_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.020189393805649738
</code></pre></div></div>

<h4 id="dmkde-3"><code class="language-plaintext highlighter-rouge">DMKDE</code></h4>

<h5 id="dim--50-6">dim = 50</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_50</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_50</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_50</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>313/313 [==============================] - 3s 902us/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f7bcf388910&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_50</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 700 ms, sys: 67.6 ms, total: 768 ms
Wall time: 808 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_555_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.03234650573730469
</code></pre></div></div>

<h5 id="dim--100-6">dim = 100</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_100</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_100</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_100</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>313/313 [==============================] - 0s 1ms/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f7bce150bd0&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_100</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 1.63 s, sys: 137 ms, total: 1.77 s
Wall time: 1.37 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_564_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.031514724731445315
</code></pre></div></div>

<h5 id="dim--500-6">dim = 500</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_500</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_500</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_500</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>313/313 [==============================] - 0s 1ms/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f7bcea1c290&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_500</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 1min 33s, sys: 2.37 s, total: 1min 35s
Wall time: 51.6 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_573_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.022413377380371094
</code></pre></div></div>

<h5 id="dim--1000-6">dim = 1000</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_1000</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_1000</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_1000</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>313/313 [==============================] - 1s 2ms/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f7bcf2f0a10&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_1000</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 10min 10s, sys: 3.64 s, total: 10min 13s
Wall time: 5min 15s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_582_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.022516436767578127
</code></pre></div></div>

<h4 id="eig-dmkde-3"><code class="language-plaintext highlighter-rouge">EIG-DMKDE</code></h4>

<h5 id="dim--50-7">dim = 50</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">sgd_model_50</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_50</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_50</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_589_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_50</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 712 ms, sys: 43.4 ms, total: 756 ms
Wall time: 652 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_593_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.03234651489257813
</code></pre></div></div>

<h5 id="dim--100-7">dim = 100</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">sgd_model_100</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_100</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_100</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_599_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_100</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 507 ms, sys: 34.2 ms, total: 542 ms
Wall time: 735 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_603_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.03151473693847656
</code></pre></div></div>

<h5 id="dim--500-7">dim = 500</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">sgd_model_500</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_500</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_500</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_609_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_500</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 3.5 s, sys: 119 ms, total: 3.61 s
Wall time: 2.21 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_613_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.02241256561279297
</code></pre></div></div>

<h5 id="dim--1000-7">dim = 1000</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">700</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">sgd_model_1000</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_1000</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_1000</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_619_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_1000</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 10.4 s, sys: 161 ms, total: 10.6 s
Wall time: 6.13 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_623_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.022507661437988283
</code></pre></div></div>

<h2 id="experiment-5--100000">Experiment 5 : 100000</h2>

<p>Split data</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">X_train_densities</span><span class="p">,</span> <span class="n">X_test_densities</span>  <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X_densities</span><span class="p">,</span> <span class="n">train_size</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Train 2D data set shape is:</span><span class="si">{</span><span class="n">X_train</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s"> and their densities shape is </span><span class="si">{</span><span class="n">X_train_densities</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Train 2D data set shape is:</span><span class="si">{</span><span class="n">X_test</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s"> and their densities shape is </span><span class="si">{</span><span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Train 2D data set shape is:(100000, 2) and their densities shape is (100000,)
Train 2D data set shape is:(10000, 2) and their densities shape is (10000,)
</code></pre></div></div>

<p>Scatter plot of test data</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">X_test_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="c1">#plt.colorbar()
</span><span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'testdensities_pot3.png'</span><span class="p">,</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_631_0.png" alt="png" /></p>

<h3 id="fixing-bandwidth---use-10000-bandwidth">Fixing bandwidth - Use 10.000 bandwidth</h3>

<p>Cross Validation with 5 folds</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gammas</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">l1_error_means</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">gamma</span> <span class="ow">in</span> <span class="n">gammas</span><span class="p">:</span> 
  <span class="n">l1_error</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="c1">#print(gamma) 
</span>  <span class="c1"># Mean of accuracy on the 5 folds wrt rawkde
</span>  <span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">kf</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">X_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">X_train_new</span><span class="p">,</span> <span class="n">X_test_new</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">train_index</span><span class="p">,:],</span> <span class="n">X_train</span><span class="p">[</span><span class="n">test_index</span><span class="p">,:]</span>
    <span class="n">X_test_real_densities</span> <span class="o">=</span> <span class="n">pot_3</span><span class="p">(</span><span class="n">X_test_new</span><span class="p">).</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">raw_kde_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">raw_kde</span><span class="p">(</span><span class="n">xtest</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">X_train_new</span> <span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">)</span> <span class="k">for</span> <span class="n">xtest</span> <span class="ow">in</span> <span class="n">X_test_new</span><span class="p">])</span>    
    <span class="n">mae</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_real_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">raw_kde_densities</span> <span class="o">-</span> <span class="n">X_test_real_densities</span><span class="p">))</span>
    <span class="n">l1_error</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">mae</span><span class="p">)</span>    
    <span class="c1">#print(mae)
</span>  <span class="c1">#print('gamma:{} error:{}'.format(gamma,np.mean(l1_error)))
</span>  <span class="n">l1_error_means</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">l1_error</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Best gamma:{} with L1_error {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">gammas</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">l1_error_means</span><span class="p">)],</span><span class="n">np</span><span class="p">.</span><span class="nb">min</span><span class="p">(</span><span class="n">l1_error_means</span><span class="p">)))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Best gamma:32 with L1_error 0.006412727219440295
</code></pre></div></div>

<p>Fixed gamma</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gamma</span> <span class="o">=</span> <span class="mi">32</span>
</code></pre></div></div>

<p>Fixed bandwidth</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bw</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">gamma</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bw</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.125
</code></pre></div></div>

<h3 id="methods-4">Methods</h3>

<h4 id="raw_kde-4"><code class="language-plaintext highlighter-rouge">raw_kde</code></h4>

<p>Train and evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span> 
  <span class="o">%</span><span class="n">time</span> <span class="n">raw_kde_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">raw_kde</span><span class="p">(</span><span class="n">xtest</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">X_train</span> <span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">)</span> <span class="k">for</span> <span class="n">xtest</span> <span class="ow">in</span> <span class="n">X_test</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 34.5 s, sys: 251 ms, total: 34.8 s
Wall time: 34.7 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">raw_kde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'testdensities_pot3_rawkde100k.png'</span><span class="p">,</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_645_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">raw_kde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.018267413671176926
</code></pre></div></div>

<h4 id="naivekde-4"><code class="language-plaintext highlighter-rouge">NaiveKDE</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">NaiveKDE_density</span> <span class="o">=</span> <span class="n">NaiveKDE</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bw</span> <span class="o">=</span> <span class="n">bw</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">NaiveKDE_densities</span> <span class="o">=</span> <span class="n">NaiveKDE_density</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 1min 21s, sys: 149 ms, total: 1min 21s
Wall time: 1min 21s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">NaiveKDE_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'testdensities_pot3_naivekde100k.png'</span><span class="p">,</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_654_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">NaiveKDE_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.018267413812446065
</code></pre></div></div>

<h4 id="treekde-4"><code class="language-plaintext highlighter-rouge">TreeKDE</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">TreeKDE_density</span> <span class="o">=</span> <span class="n">TreeKDE</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bw</span> <span class="o">=</span> <span class="n">bw</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">TreeKDE_densities</span> <span class="o">=</span> <span class="n">TreeKDE_density</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 22.8 s, sys: 118 ms, total: 22.9 s
Wall time: 22.8 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">TreeKDE_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'testdensities_pot3_treekde100k.png'</span><span class="p">,</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_663_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">TreeKDE_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.018253850497096387
</code></pre></div></div>

<h4 id="kerneldensityalgorithm--ball_tree-4"><code class="language-plaintext highlighter-rouge">KernelDensity(algorithm = 'ball_tree')</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">KernelDensitybt_density</span> <span class="o">=</span> <span class="n">KernelDensity</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">bw</span><span class="p">,</span> <span class="n">algorithm</span> <span class="o">=</span> <span class="s">'ball_tree'</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">KernelDensitybt_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">KernelDensitybt_density</span><span class="p">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 47 s, sys: 102 ms, total: 47.1 s
Wall time: 47 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">KernelDensitybt_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'testdensities_pot3_kerneldensitybtkde100k.png'</span><span class="p">,</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_672_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">KernelDensitybt_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.018267413812417345
</code></pre></div></div>

<h4 id="kerneldensityalgorithm--kd_tree-4"><code class="language-plaintext highlighter-rouge">KernelDensity(algorithm = 'kd_tree')</code></h4>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">KernelDensitykdt_density</span> <span class="o">=</span> <span class="n">KernelDensity</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s">'gaussian'</span><span class="p">,</span> <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">bw</span><span class="p">,</span> <span class="n">algorithm</span> <span class="o">=</span> <span class="s">'kd_tree'</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">KernelDensitykdt_densities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">KernelDensitykdt_density</span><span class="p">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 54.5 s, sys: 206 ms, total: 54.7 s
Wall time: 54.4 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">KernelDensitykdt_densities</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'testdensities_pot3_kerneldensitykdtkde100k.png'</span><span class="p">,</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_681_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">KernelDensitykdt_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.018267413812416575
</code></pre></div></div>

<h4 id="fastkde-4"><code class="language-plaintext highlighter-rouge">fastKDE</code></h4>

<p>Train and evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">fastKDE_densities</span> <span class="o">=</span> <span class="n">fastKDE</span><span class="p">.</span><span class="n">pdf_at_points</span><span class="p">(</span><span class="n">X_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_train</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">list_of_points</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 15.2 s, sys: 20.6 ms, total: 15.3 s
Wall time: 15.2 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">fastKDE_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_688_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">fastKDE_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.019015339817145163
</code></pre></div></div>

<h4 id="dmkde-4"><code class="language-plaintext highlighter-rouge">DMKDE</code></h4>

<h5 id="dim--50-8">dim = 50</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_50</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_50</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_50</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3125/3125 [==============================] - 3s 822us/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f7bbe60dd90&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_50</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 668 ms, sys: 34.5 ms, total: 703 ms
Wall time: 587 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_698_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.025264669799804688
</code></pre></div></div>

<h5 id="dim--100-8">dim = 100</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_100</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_100</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_100</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3125/3125 [==============================] - 3s 809us/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f7bbe60de10&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_100</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 1.57 s, sys: 195 ms, total: 1.77 s
Wall time: 1.38 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_707_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.027048080444335938
</code></pre></div></div>

<h5 id="dim--500-8">dim = 500</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_500</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_500</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_500</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3125/3125 [==============================] - 6s 903us/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f1098130110&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_500</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 1min 30s, sys: 3.46 s, total: 1min 33s
Wall time: 51.1 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_716_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.029965219116210938
</code></pre></div></div>

<h5 id="dim--1000-8">dim = 1000</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dim</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">fm_x</span> <span class="o">=</span> <span class="n">layers</span><span class="p">.</span><span class="n">QFeatureMapRFF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">qmd_1000</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensity</span><span class="p">(</span><span class="n">fm_x</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span class="n">qmd_1000</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
<span class="n">qmd_1000</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3125/3125 [==============================] - 11s 3ms/step





&lt;tensorflow.python.keras.callbacks.History at 0x7f246af454d0&gt;
</code></pre></div></div>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
 <span class="o">%</span><span class="n">time</span> <span class="n">dmkde_densities</span> <span class="o">=</span> <span class="n">qmd_1000</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 9min 55s, sys: 7.59 s, total: 10min 2s
Wall time: 5min 13s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_725_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.03011076354980469
</code></pre></div></div>

<h4 id="eig-dmkde-4"><code class="language-plaintext highlighter-rouge">EIG-DMKDE</code></h4>

<h5 id="dim--50-9">dim = 50</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">sgd_model_50</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_50</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_50</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_732_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_50</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 442 ms, sys: 39.7 ms, total: 481 ms
Wall time: 374 ms
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_736_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.025264671325683594
</code></pre></div></div>

<h5 id="dim--100-9">dim = 100</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">sgd_model_100</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_100</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_100</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_742_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_100</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 769 ms, sys: 40.7 ms, total: 810 ms
Wall time: 1.01 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_746_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.07530401611328125
</code></pre></div></div>

<h5 id="dim--500-9">dim = 500</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">sgd_model_500</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_500</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_500</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_752_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_500</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 3.89 s, sys: 120 ms, total: 4.01 s
Wall time: 2.46 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_756_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.02996368408203125
</code></pre></div></div>

<h5 id="dim--1000-9">dim = 1000</h5>

<p>Train</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_eig</span> <span class="o">=</span> <span class="mi">700</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">sgd_model_1000</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">QMDensitySGD</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_eig</span> <span class="o">=</span> <span class="n">num_eig</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">eig_vals</span> <span class="o">=</span> <span class="n">sgd_model_1000</span><span class="p">.</span><span class="n">set_rho</span><span class="p">(</span><span class="n">qmd_1000</span><span class="p">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eig_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_762_0.png" alt="png" /></p>

<p>Evaluate</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">device</span><span class="p">(</span><span class="s">'/cpu:0'</span><span class="p">):</span>
  <span class="o">%</span><span class="n">time</span> <span class="n">sgd_dmkde_densities</span> <span class="o">=</span>  <span class="n">calculate_constant_qmkde</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgd_model_1000</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU times: user 13.3 s, sys: 267 ms, total: 13.6 s
Wall time: 8.08 s
</code></pre></div></div>

<p>Scatter plot</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">sgd_dmkde_densities</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span> <span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'testdensities_pot3_eigdmkde1000100k.png'</span><span class="p">,</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_766_0.png" alt="png" /></p>

<p>$L_1$ error</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span> <span class="o">/</span> <span class="n">X_test_densities</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgd_dmkde_densities</span> <span class="o">-</span> <span class="n">X_test_densities</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.03009693603515625
</code></pre></div></div>

<h2 id="final-timing-plot">Final timing plot</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="mf">0.75</span><span class="p">,</span><span class="mi">15</span><span class="o">*</span><span class="mf">0.75</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train_size</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e1</span><span class="p">,</span><span class="mf">1e2</span><span class="p">,</span><span class="mf">1e3</span><span class="p">,</span><span class="mf">1e4</span><span class="p">,</span><span class="mf">1e5</span><span class="p">]</span>
<span class="c1">#raw_kde
</span><span class="n">CPU_time_raw_kde</span> <span class="o">=</span> <span class="p">[</span><span class="mi">269</span><span class="p">,</span><span class="mi">336</span><span class="p">,</span><span class="mi">598</span><span class="p">,</span><span class="mi">3100</span><span class="p">,</span><span class="mi">30200</span><span class="p">]</span>
<span class="c1">#NaiveKDE
</span><span class="n">CPU_time_NaiveKDE</span> <span class="o">=</span> <span class="p">[</span><span class="mf">13.7</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">981</span><span class="p">,</span><span class="mi">1630</span><span class="p">,</span><span class="mi">72000</span><span class="p">]</span>
<span class="c1">#TreeKDE
</span><span class="n">CPU_time_TreeKDE</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4800</span><span class="p">,</span><span class="mi">3120</span><span class="p">,</span><span class="mi">4940</span><span class="p">,</span><span class="mi">5060</span><span class="p">,</span><span class="mi">19900</span><span class="p">]</span>
<span class="c1">#KernelDensitybt
</span><span class="n">CPU_time_KernelDensitybt</span> <span class="o">=</span> <span class="p">[</span><span class="mf">8.14</span><span class="p">,</span><span class="mf">67.5</span><span class="p">,</span><span class="mi">524</span><span class="p">,</span><span class="mi">2850</span><span class="p">,</span><span class="mi">41100</span><span class="p">]</span>
<span class="c1">#KernelDensitykdt
</span><span class="n">CPU_time_KernelDensitykdt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mf">68.4</span><span class="p">,</span><span class="mi">550</span><span class="p">,</span><span class="mi">3880</span><span class="p">,</span><span class="mi">48900</span><span class="p">]</span>
<span class="c1">#fastKDE
#CPU_time_fastKDE = [7430,15000,14300,14700,15200]
#DMKDE_50
</span><span class="n">CPU_time_DMKDE_50</span> <span class="o">=</span> <span class="p">[</span><span class="mi">849</span><span class="p">,</span><span class="mi">824</span><span class="p">,</span><span class="mi">848</span><span class="p">,</span><span class="mi">700</span><span class="p">,</span><span class="mi">668</span><span class="p">]</span>
<span class="c1">#DMKDE_100
</span><span class="n">CPU_time_DMKDE_100</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2010</span><span class="p">,</span><span class="mi">2100</span><span class="p">,</span><span class="mi">2110</span><span class="p">,</span><span class="mi">1610</span><span class="p">,</span><span class="mi">1570</span><span class="p">]</span>
<span class="c1">#DMKDE_500
</span><span class="n">CPU_time_DMKDE_500</span> <span class="o">=</span> <span class="p">[</span><span class="mi">108000</span><span class="p">,</span><span class="mi">110000</span><span class="p">,</span><span class="mi">113000</span><span class="p">,</span><span class="mi">93000</span><span class="p">,</span><span class="mi">90000</span><span class="p">]</span>
<span class="c1">#DMKDE_1000
</span><span class="n">CPU_time_DMKDE_1000</span> <span class="o">=</span> <span class="p">[</span><span class="mi">766000</span><span class="p">,</span><span class="mi">777000</span><span class="p">,</span><span class="mi">786000</span><span class="p">,</span><span class="mi">610000</span><span class="p">,</span><span class="mi">595000</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_50
</span><span class="n">CPU_time_EIG_DMKDE_50</span> <span class="o">=</span> <span class="p">[</span><span class="mi">711</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">552</span><span class="p">,</span><span class="mi">712</span><span class="p">,</span><span class="mi">442</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_100
</span><span class="n">CPU_time_EIG_DMKDE_100</span> <span class="o">=</span> <span class="p">[</span><span class="mi">591</span><span class="p">,</span><span class="mi">604</span><span class="p">,</span><span class="mi">601</span><span class="p">,</span><span class="mi">507</span><span class="p">,</span><span class="mi">492</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_500
</span><span class="n">CPU_time_EIG_DMKDE_500</span> <span class="o">=</span> <span class="p">[</span><span class="mi">651</span><span class="p">,</span><span class="mi">892</span><span class="p">,</span><span class="mi">1940</span><span class="p">,</span><span class="mi">3500</span><span class="p">,</span><span class="mi">3280</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_1000
</span><span class="n">CPU_time_EIG_DMKDE_1000</span> <span class="o">=</span> <span class="p">[</span><span class="mi">880</span><span class="p">,</span><span class="mi">1120</span><span class="p">,</span><span class="mi">3050</span><span class="p">,</span><span class="mi">10400</span><span class="p">,</span><span class="mi">9920</span><span class="p">]</span>

<span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">CPU_time_raw_kde</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'tab:blue'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'raw_kde'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">CPU_time_NaiveKDE</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'tab:orange'</span> <span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'NaiveKDE'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">CPU_time_TreeKDE</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'tab:green'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'TreeKDE'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">CPU_time_KernelDensitybt</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'tab:red'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'KernelDensitybt'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">CPU_time_KernelDensitykdt</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'tab:purple'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'KernelDensitykdt'</span><span class="p">)</span>
<span class="c1">#plt.plot(train_size,CPU_time_fastKDE, c = 'tab:brown', marker = 's', label = 'fastKDE')
</span><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">CPU_time_DMKDE_50</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'khaki'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'DMKDE_50'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">CPU_time_DMKDE_100</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'gold'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'DMKDE_100'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">CPU_time_DMKDE_500</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'goldenrod'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'DMKDE_500'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">CPU_time_DMKDE_1000</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'darkgoldenrod'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'DMKDE_1000'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">CPU_time_EIG_DMKDE_50</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'khaki'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s">'--'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'EIG_DMKDE_50'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">CPU_time_EIG_DMKDE_100</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'gold'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s">'--'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'EIG_DMKDE_100'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">CPU_time_EIG_DMKDE_500</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'goldenrod'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s">'--'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'EIG_DMKDE_500'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">CPU_time_EIG_DMKDE_1000</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'darkgoldenrod'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s">'--'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'EIG_DMKDE_1000'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">yscale</span><span class="p">(</span><span class="s">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xscale</span><span class="p">(</span><span class="s">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Train size'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'CPU time (ms)'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Potential 3'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'time_pot3.png'</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_771_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train_size</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e1</span><span class="p">,</span><span class="mf">1e2</span><span class="p">,</span><span class="mf">1e3</span><span class="p">,</span><span class="mf">1e4</span><span class="p">,</span><span class="mf">1e5</span><span class="p">]</span>
<span class="c1">#raw_kde
</span><span class="n">error_raw_kde</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0503</span><span class="p">,</span><span class="mf">0.0332</span><span class="p">,</span><span class="mf">0.0258</span><span class="p">,</span><span class="mf">0.0198</span><span class="p">,</span><span class="mf">0.0182</span><span class="p">]</span>
<span class="c1">#NaiveKDE
</span><span class="n">error_NaiveKDE</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0503</span><span class="p">,</span><span class="mf">0.0332</span><span class="p">,</span><span class="mf">0.0258</span><span class="p">,</span><span class="mf">0.0198</span><span class="p">,</span><span class="mf">0.0182</span><span class="p">]</span>
<span class="c1">#TreeKDE
</span><span class="n">error_TreeKDE</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0503</span><span class="p">,</span><span class="mf">0.0332</span><span class="p">,</span><span class="mf">0.0258</span><span class="p">,</span><span class="mf">0.0198</span><span class="p">,</span><span class="mf">0.0182</span><span class="p">]</span>
<span class="c1">#KernelDensitybt
</span><span class="n">error_KernelDensitybt</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0503</span><span class="p">,</span><span class="mf">0.0332</span><span class="p">,</span><span class="mf">0.0258</span><span class="p">,</span><span class="mf">0.0198</span><span class="p">,</span><span class="mf">0.0182</span><span class="p">]</span>
<span class="c1">#KernelDensitykdt
</span><span class="n">error_KernelDensitykdt</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0503</span><span class="p">,</span><span class="mf">0.0332</span><span class="p">,</span><span class="mf">0.0258</span><span class="p">,</span><span class="mf">0.0198</span><span class="p">,</span><span class="mf">0.0182</span><span class="p">]</span>
<span class="c1">#fastKDE
#error_fastKDE = [0.0589,0.0432,0.0267,0.0201,0.0190]
#DMKDE_50
</span><span class="n">error_DMKDE_50</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0595</span><span class="p">,</span><span class="mf">0.0785</span><span class="p">,</span><span class="mf">0.0360</span><span class="p">,</span><span class="mf">0.0323</span><span class="p">,</span><span class="mf">0.0252</span><span class="p">]</span>
<span class="c1">#DMKDE_100
</span><span class="n">error_DMKDE_100</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0640</span><span class="p">,</span><span class="mf">0.0616</span><span class="p">,</span><span class="mf">0.0357</span><span class="p">,</span><span class="mf">0.0315</span><span class="p">,</span><span class="mf">0.0270</span><span class="p">]</span>
<span class="c1">#DMKDE_500
</span><span class="n">error_DMKDE_500</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0644</span><span class="p">,</span><span class="mf">0.0390</span><span class="p">,</span><span class="mf">0.0257</span><span class="p">,</span><span class="mf">0.0224</span><span class="p">,</span><span class="mf">0.0299</span><span class="p">]</span>
<span class="c1">#DMKDE_1000
</span><span class="n">error_DMKDE_1000</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0644</span><span class="p">,</span><span class="mf">0.0385</span><span class="p">,</span><span class="mf">0.0256</span><span class="p">,</span><span class="mf">0.0225</span><span class="p">,</span><span class="mf">0.0301</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_50
</span><span class="n">error_EIG_DMKDE_50</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0595</span><span class="p">,</span><span class="mf">0.0785</span><span class="p">,</span><span class="mf">0.0360</span><span class="p">,</span><span class="mf">0.0323</span><span class="p">,</span><span class="mf">0.0252</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_100
</span><span class="n">error_EIG_DMKDE_100</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0640</span><span class="p">,</span><span class="mf">0.0616</span><span class="p">,</span><span class="mf">0.0357</span><span class="p">,</span><span class="mf">0.0315</span><span class="p">,</span><span class="mf">0.0753</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_500
</span><span class="n">error_EIG_DMKDE_500</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0644</span><span class="p">,</span><span class="mf">0.0390</span><span class="p">,</span><span class="mf">0.0257</span><span class="p">,</span><span class="mf">0.0224</span><span class="p">,</span><span class="mf">0.0299</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_1000
</span><span class="n">error_EIG_DMKDE_1000</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.644</span><span class="p">,</span><span class="mf">0.0385</span><span class="p">,</span><span class="mf">0.0256</span><span class="p">,</span><span class="mf">0.0225</span><span class="p">,</span><span class="mf">0.0300</span><span class="p">]</span>

<span class="n">plt</span><span class="p">.</span><span class="n">axes</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">error_raw_kde</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'tab:blue'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'raw_kde'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">error_NaiveKDE</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'tab:orange'</span> <span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'NaiveKDE'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">error_TreeKDE</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'tab:green'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'TreeKDE'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">error_KernelDensitybt</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'tab:red'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'KernelDensitybt'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">error_KernelDensitykdt</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'tab:purple'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'KernelDensitykdt'</span><span class="p">)</span>
<span class="c1">#plt.plot(train_size,error_fastKDE, c = 'tab:brown', marker = 's', label = 'fastKDE')
</span><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">error_DMKDE_50</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'khaki'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'DMKDE_50'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">error_DMKDE_100</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'gold'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'DMKDE_100'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">error_DMKDE_500</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'goldenrod'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'DMKDE_500'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">error_DMKDE_1000</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'darkgoldenrod'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'DMKDE_1000'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">error_EIG_DMKDE_50</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'khaki'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s">'--'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'EIG_DMKDE_50'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">error_EIG_DMKDE_100</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'gold'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s">'--'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'EIG_DMKDE_100'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">error_EIG_DMKDE_500</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'goldenrod'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s">'--'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'EIG_DMKDE_500'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_size</span><span class="p">,</span><span class="n">error_EIG_DMKDE_1000</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">'darkgoldenrod'</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">'s'</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s">'--'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'EIG_DMKDE_1000'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">yscale</span><span class="p">(</span><span class="s">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xscale</span><span class="p">(</span><span class="s">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Train size'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'MAE'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Potential 3'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'mae_pot3.png'</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_772_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#raw_kde
</span><span class="n">CPU_time_raw_kde</span> <span class="o">=</span> <span class="p">[</span><span class="mi">269</span><span class="p">,</span><span class="mi">336</span><span class="p">,</span><span class="mi">598</span><span class="p">,</span><span class="mi">3100</span><span class="p">,</span><span class="mi">30200</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#NaiveKDE
</span><span class="n">CPU_time_NaiveKDE</span> <span class="o">=</span> <span class="p">[</span><span class="mf">13.7</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">981</span><span class="p">,</span><span class="mi">1630</span><span class="p">,</span><span class="mi">72000</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#TreeKDE
</span><span class="n">CPU_time_TreeKDE</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4800</span><span class="p">,</span><span class="mi">3120</span><span class="p">,</span><span class="mi">4940</span><span class="p">,</span><span class="mi">5060</span><span class="p">,</span><span class="mi">19900</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#KernelDensitybt
</span><span class="n">CPU_time_KernelDensitybt</span> <span class="o">=</span> <span class="p">[</span><span class="mf">8.14</span><span class="p">,</span><span class="mf">67.5</span><span class="p">,</span><span class="mi">524</span><span class="p">,</span><span class="mi">2850</span><span class="p">,</span><span class="mi">41100</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#KernelDensitykdt
</span><span class="n">CPU_time_KernelDensitykdt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="mf">68.4</span><span class="p">,</span><span class="mi">550</span><span class="p">,</span><span class="mi">3880</span><span class="p">,</span><span class="mi">48900</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#fastKDE
#CPU_time_fastKDE = [7430,15000,14300,14700,15200][4]
#DMKDE_50
</span><span class="n">CPU_time_DMKDE_50</span> <span class="o">=</span> <span class="p">[</span><span class="mi">849</span><span class="p">,</span><span class="mi">824</span><span class="p">,</span><span class="mi">848</span><span class="p">,</span><span class="mi">700</span><span class="p">,</span><span class="mi">668</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#DMKDE_100
</span><span class="n">CPU_time_DMKDE_100</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2010</span><span class="p">,</span><span class="mi">2100</span><span class="p">,</span><span class="mi">2110</span><span class="p">,</span><span class="mi">1610</span><span class="p">,</span><span class="mi">1570</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#DMKDE_500
</span><span class="n">CPU_time_DMKDE_500</span> <span class="o">=</span> <span class="p">[</span><span class="mi">108000</span><span class="p">,</span><span class="mi">110000</span><span class="p">,</span><span class="mi">113000</span><span class="p">,</span><span class="mi">93000</span><span class="p">,</span><span class="mi">90000</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#DMKDE_1000
</span><span class="n">CPU_time_DMKDE_1000</span> <span class="o">=</span> <span class="p">[</span><span class="mi">766000</span><span class="p">,</span><span class="mi">777000</span><span class="p">,</span><span class="mi">786000</span><span class="p">,</span><span class="mi">610000</span><span class="p">,</span><span class="mi">595000</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_50
</span><span class="n">CPU_time_EIG_DMKDE_50</span> <span class="o">=</span> <span class="p">[</span><span class="mi">711</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">552</span><span class="p">,</span><span class="mi">712</span><span class="p">,</span><span class="mi">442</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_100
</span><span class="n">CPU_time_EIG_DMKDE_100</span> <span class="o">=</span> <span class="p">[</span><span class="mi">591</span><span class="p">,</span><span class="mi">604</span><span class="p">,</span><span class="mi">601</span><span class="p">,</span><span class="mi">507</span><span class="p">,</span><span class="mi">492</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_500
</span><span class="n">CPU_time_EIG_DMKDE_500</span> <span class="o">=</span> <span class="p">[</span><span class="mi">651</span><span class="p">,</span><span class="mi">892</span><span class="p">,</span><span class="mi">1940</span><span class="p">,</span><span class="mi">3500</span><span class="p">,</span><span class="mi">3280</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_1000
</span><span class="n">CPU_time_EIG_DMKDE_1000</span> <span class="o">=</span> <span class="p">[</span><span class="mi">880</span><span class="p">,</span><span class="mi">1120</span><span class="p">,</span><span class="mi">3050</span><span class="p">,</span><span class="mi">10400</span><span class="p">,</span><span class="mi">9920</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>


<span class="c1">#raw_kde
</span><span class="n">error_raw_kde</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0503</span><span class="p">,</span><span class="mf">0.0332</span><span class="p">,</span><span class="mf">0.0258</span><span class="p">,</span><span class="mf">0.0198</span><span class="p">,</span><span class="mf">0.0182</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#NaiveKDE
</span><span class="n">error_NaiveKDE</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0503</span><span class="p">,</span><span class="mf">0.0332</span><span class="p">,</span><span class="mf">0.0258</span><span class="p">,</span><span class="mf">0.0198</span><span class="p">,</span><span class="mf">0.0182</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#TreeKDE
</span><span class="n">error_TreeKDE</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0503</span><span class="p">,</span><span class="mf">0.0332</span><span class="p">,</span><span class="mf">0.0258</span><span class="p">,</span><span class="mf">0.0198</span><span class="p">,</span><span class="mf">0.0182</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#KernelDensitybt
</span><span class="n">error_KernelDensitybt</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0503</span><span class="p">,</span><span class="mf">0.0332</span><span class="p">,</span><span class="mf">0.0258</span><span class="p">,</span><span class="mf">0.0198</span><span class="p">,</span><span class="mf">0.0182</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#KernelDensitykdt
</span><span class="n">error_KernelDensitykdt</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0503</span><span class="p">,</span><span class="mf">0.0332</span><span class="p">,</span><span class="mf">0.0258</span><span class="p">,</span><span class="mf">0.0198</span><span class="p">,</span><span class="mf">0.0182</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#fastKDE
#error_fastKDE = [0.0589,0.0432,0.0267,0.0201,0.0190][4]
#DMKDE_50
</span><span class="n">error_DMKDE_50</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0595</span><span class="p">,</span><span class="mf">0.0785</span><span class="p">,</span><span class="mf">0.0360</span><span class="p">,</span><span class="mf">0.0323</span><span class="p">,</span><span class="mf">0.0252</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#DMKDE_100
</span><span class="n">error_DMKDE_100</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0640</span><span class="p">,</span><span class="mf">0.0616</span><span class="p">,</span><span class="mf">0.0357</span><span class="p">,</span><span class="mf">0.0315</span><span class="p">,</span><span class="mf">0.0270</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#DMKDE_500
</span><span class="n">error_DMKDE_500</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0644</span><span class="p">,</span><span class="mf">0.0390</span><span class="p">,</span><span class="mf">0.0257</span><span class="p">,</span><span class="mf">0.0224</span><span class="p">,</span><span class="mf">0.0299</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#DMKDE_1000
</span><span class="n">error_DMKDE_1000</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0644</span><span class="p">,</span><span class="mf">0.0385</span><span class="p">,</span><span class="mf">0.0256</span><span class="p">,</span><span class="mf">0.0225</span><span class="p">,</span><span class="mf">0.0301</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_50
</span><span class="n">error_EIG_DMKDE_50</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0595</span><span class="p">,</span><span class="mf">0.0785</span><span class="p">,</span><span class="mf">0.0360</span><span class="p">,</span><span class="mf">0.0323</span><span class="p">,</span><span class="mf">0.0252</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_100
</span><span class="n">error_EIG_DMKDE_100</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0640</span><span class="p">,</span><span class="mf">0.0616</span><span class="p">,</span><span class="mf">0.0357</span><span class="p">,</span><span class="mf">0.0315</span><span class="p">,</span><span class="mf">0.0753</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_500
</span><span class="n">error_EIG_DMKDE_500</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0644</span><span class="p">,</span><span class="mf">0.0390</span><span class="p">,</span><span class="mf">0.0257</span><span class="p">,</span><span class="mf">0.0224</span><span class="p">,</span><span class="mf">0.0299</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_1000
</span><span class="n">error_EIG_DMKDE_1000</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.644</span><span class="p">,</span><span class="mf">0.0385</span><span class="p">,</span><span class="mf">0.0256</span><span class="p">,</span><span class="mf">0.0225</span><span class="p">,</span><span class="mf">0.0300</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>

<span class="n">scatter_100m</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="n">CPU_time_raw_kde</span><span class="p">,</span><span class="n">error_raw_kde</span><span class="p">],</span>
                <span class="p">[</span><span class="n">CPU_time_NaiveKDE</span><span class="p">,</span><span class="n">error_NaiveKDE</span><span class="p">],</span>
                <span class="p">[</span><span class="n">CPU_time_TreeKDE</span><span class="p">,</span><span class="n">error_TreeKDE</span><span class="p">],</span>
                <span class="p">[</span><span class="n">CPU_time_KernelDensitybt</span><span class="p">,</span><span class="n">error_KernelDensitybt</span><span class="p">],</span>
                <span class="p">[</span><span class="n">CPU_time_KernelDensitykdt</span><span class="p">,</span><span class="n">error_KernelDensitykdt</span><span class="p">],</span>
                <span class="p">[</span><span class="n">CPU_time_DMKDE_50</span><span class="p">,</span><span class="n">error_DMKDE_50</span><span class="p">],</span>
                <span class="p">[</span><span class="n">CPU_time_DMKDE_100</span><span class="p">,</span><span class="n">error_DMKDE_100</span><span class="p">],</span>
                <span class="p">[</span><span class="n">CPU_time_DMKDE_500</span><span class="p">,</span><span class="n">error_DMKDE_500</span><span class="p">],</span>
                <span class="p">[</span><span class="n">CPU_time_EIG_DMKDE_1000</span><span class="p">,</span><span class="n">error_DMKDE_1000</span><span class="p">],</span>
                <span class="p">[</span><span class="n">CPU_time_EIG_DMKDE_50</span><span class="p">,</span><span class="n">error_DMKDE_50</span><span class="p">],</span>
                <span class="p">[</span><span class="n">CPU_time_EIG_DMKDE_100</span><span class="p">,</span><span class="n">error_DMKDE_100</span><span class="p">],</span>
                <span class="p">[</span><span class="n">CPU_time_EIG_DMKDE_500</span><span class="p">,</span><span class="n">error_DMKDE_500</span><span class="p">],</span>
                <span class="p">[</span><span class="n">CPU_time_EIG_DMKDE_1000</span><span class="p">,</span><span class="n">error_DMKDE_1000</span><span class="p">]</span>
                <span class="p">]).</span><span class="n">T</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s">'raw_kde'</span><span class="p">,</span><span class="s">'NaiveKDE'</span><span class="p">,</span><span class="s">'TreeKDE'</span><span class="p">,</span><span class="s">'KernelDensitybt'</span><span class="p">,</span><span class="s">'KernelDensitykdt'</span><span class="p">,</span><span class="s">'DMKDE_50'</span><span class="p">,</span><span class="s">'DMKDE_100'</span><span class="p">,</span><span class="s">'DMKDE_500'</span><span class="p">,</span><span class="s">'DMKDE_1000'</span><span class="p">,</span><span class="s">'EIG_DMKDE_50'</span><span class="p">,</span><span class="s">'EIG_DMKDE_100'</span>
<span class="p">,</span><span class="s">'EIG_DMKDE_500'</span><span class="p">,</span><span class="s">'EIG_DMKDE_1000'</span><span class="p">]</span>

<span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="s">'tab:blue'</span><span class="p">,</span><span class="s">'tab:orange'</span><span class="p">,</span><span class="s">'tab:green'</span><span class="p">,</span><span class="s">'tab:red'</span><span class="p">,</span><span class="s">'tab:purple'</span><span class="p">,</span><span class="s">'khaki'</span><span class="p">,</span><span class="s">'gold'</span><span class="p">,</span><span class="s">'goldenrod'</span><span class="p">,</span><span class="s">'darkgoldenrod'</span><span class="p">,</span><span class="s">'khaki'</span><span class="p">,</span><span class="s">'gold'</span><span class="p">,</span><span class="s">'goldenrod'</span><span class="p">,</span><span class="s">'darkgoldenrod'</span><span class="p">])</span>

<span class="c1">#
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">j</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">color</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">labels</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">scatter_100m</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="n">scatter_100m</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">spines</span><span class="p">[</span><span class="s">"bottom"</span><span class="p">].</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">spines</span><span class="p">[</span><span class="s">"top"</span><span class="p">].</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">spines</span><span class="p">[</span><span class="s">"right"</span><span class="p">].</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">spines</span><span class="p">[</span><span class="s">"left"</span><span class="p">].</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="n">label</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s">'none'</span><span class="p">)</span>
    <span class="n">j</span><span class="o">+=</span><span class="mi">1</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'CPU time (ms)'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'MAE'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Potential 3'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'eff_pot3.png'</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_773_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#EIG_DMKDE_50
</span><span class="n">CPU_time_EIG_DMKDE_50</span> <span class="o">=</span> <span class="p">[</span><span class="mi">711</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">552</span><span class="p">,</span><span class="mi">712</span><span class="p">,</span><span class="mi">442</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_100
</span><span class="n">CPU_time_EIG_DMKDE_100</span> <span class="o">=</span> <span class="p">[</span><span class="mi">591</span><span class="p">,</span><span class="mi">604</span><span class="p">,</span><span class="mi">601</span><span class="p">,</span><span class="mi">507</span><span class="p">,</span><span class="mi">492</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_500
</span><span class="n">CPU_time_EIG_DMKDE_500</span> <span class="o">=</span> <span class="p">[</span><span class="mi">651</span><span class="p">,</span><span class="mi">892</span><span class="p">,</span><span class="mi">1940</span><span class="p">,</span><span class="mi">3500</span><span class="p">,</span><span class="mi">3280</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_1000
</span><span class="n">CPU_time_EIG_DMKDE_1000</span> <span class="o">=</span> <span class="p">[</span><span class="mi">880</span><span class="p">,</span><span class="mi">1120</span><span class="p">,</span><span class="mi">3050</span><span class="p">,</span><span class="mi">10400</span><span class="p">,</span><span class="mi">9920</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>

<span class="c1">#EIG_DMKDE_50
</span><span class="n">error_EIG_DMKDE_50</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0595</span><span class="p">,</span><span class="mf">0.0785</span><span class="p">,</span><span class="mf">0.0360</span><span class="p">,</span><span class="mf">0.0323</span><span class="p">,</span><span class="mf">0.0252</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_100
</span><span class="n">error_EIG_DMKDE_100</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0640</span><span class="p">,</span><span class="mf">0.0616</span><span class="p">,</span><span class="mf">0.0357</span><span class="p">,</span><span class="mf">0.0315</span><span class="p">,</span><span class="mf">0.0753</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_500
</span><span class="n">error_EIG_DMKDE_500</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0644</span><span class="p">,</span><span class="mf">0.0390</span><span class="p">,</span><span class="mf">0.0257</span><span class="p">,</span><span class="mf">0.0224</span><span class="p">,</span><span class="mf">0.0299</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="c1">#EIG_DMKDE_1000
</span><span class="n">error_EIG_DMKDE_1000</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.644</span><span class="p">,</span><span class="mf">0.0385</span><span class="p">,</span><span class="mf">0.0256</span><span class="p">,</span><span class="mf">0.0225</span><span class="p">,</span><span class="mf">0.0300</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mf">50.</span><span class="p">,</span><span class="mf">100.</span><span class="p">,</span><span class="mf">500.</span><span class="p">,</span><span class="mf">1000.</span><span class="p">]</span>
<span class="n">data1</span> <span class="o">=</span> <span class="p">[</span><span class="n">CPU_time_DMKDE_50</span><span class="p">,</span><span class="n">CPU_time_DMKDE_100</span><span class="p">,</span><span class="n">CPU_time_DMKDE_500</span><span class="p">,</span><span class="n">CPU_time_DMKDE_1000</span><span class="p">]</span>
<span class="n">data2</span> <span class="o">=</span> <span class="p">[</span><span class="n">error_EIG_DMKDE_50</span><span class="p">,</span><span class="n">error_EIG_DMKDE_100</span><span class="p">,</span><span class="n">error_EIG_DMKDE_500</span><span class="p">,</span><span class="n">error_EIG_DMKDE_1000</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">color</span> <span class="o">=</span> <span class="s">'tab:green'</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Potential 3'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">spines</span><span class="p">[</span><span class="s">"bottom"</span><span class="p">].</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">spines</span><span class="p">[</span><span class="s">"top"</span><span class="p">].</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">spines</span><span class="p">[</span><span class="s">"right"</span><span class="p">].</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">spines</span><span class="p">[</span><span class="s">"left"</span><span class="p">].</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'RRFs dimensions'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'CPU time (ms)'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">'log'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">data1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">'y'</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">.</span><span class="n">twinx</span><span class="p">()</span>  <span class="c1"># instantiate a second axes that shares the same x-axis
</span>
<span class="n">color</span> <span class="o">=</span> <span class="s">'tab:blue'</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">spines</span><span class="p">[</span><span class="s">"bottom"</span><span class="p">].</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">spines</span><span class="p">[</span><span class="s">"top"</span><span class="p">].</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">spines</span><span class="p">[</span><span class="s">"right"</span><span class="p">].</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">spines</span><span class="p">[</span><span class="s">"left"</span><span class="p">].</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'MAE'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>  <span class="c1"># we already handled the x-label with ax1
</span><span class="n">ax2</span><span class="p">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">'log'</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">'y'</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

<span class="n">fig</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># otherwise the right y-label is slightly clipped
</span><span class="n">fig</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'rff_pot3.png'</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="DMKDE_pot3_files/DMKDE_pot3_774_0.png" alt="png" /></p>

:ET